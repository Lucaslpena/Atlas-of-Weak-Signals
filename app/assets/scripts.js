/*!
 * aows
 * 
 * 
 * @author Lucas Lorenzo Pena <lucaslpena@gmail.com>
 * @version 0.1.0
 * Copyright 2019. CC-BY-NC-SA-4.0 licensed.
 */
function Attractor(weaksignal, xCord, yCord) {
  this.ws = weaksignal;
  var length = width - 2 * padding;
  var interval = length / grid;
  var centerX = padding + interval * (xCord + 1);
  centerX = centerX - interval / 2;
  length = height - 2 * padding;
  interval = length / grid;
  var centerY = padding + interval * (yCord + 1);
  centerY = centerY - interval / 2;
  this.pos = createVector(centerX, centerY);
  this.vel = createVector(0, 0);
  this.acc = createVector(0, 0);
  this.mass = 6;
  this.G = 20; //was 80

  this.scaler = 5;

  this.calculateAttraction = function (p) {
    //calculate direction of force
    var force = p5.Vector.sub(this.pos, p.pos);
    push();
    var opa = noise(p.offset) * 255; // console.log(opa);

    stroke(color(50, 50, 50, opa)); // stroke(255);

    line(this.pos.x, this.pos.y, p.pos.x, p.pos.y);
    pop(); //distance between objects

    var distance = force.mag(); //limit vector to eliminate extreme values at very close or very far
    // distance = constrain(distance,20,25);

    distance = constrain(distance, 50, 55); //Not really important but is what it is to get direction

    force.normalize(); //calculate gravitational from magniitude

    var strength = this.G * this.mass * p.mass / (distance * distance); //get force vector --> magnitude * direction

    force.mult(strength); //var force;

    return force;
  };

  this.applyForce = function (force) {
    // A = F /M
    var f = force.copy();
    f.div(this.mass);
    this.acc.add(f);
  };

  this.update = function () {
    this.edges();
    this.vel.add(this.acc);
    this.pos.add(this.vel);
    this.acc.set(0, 0);
  };

  this.display = function () {
    push(); // fill(30,25,20);

    stroke(30, 25, 30); // ellipse(this.pos.x, this.pos.y, this.mass * this.scaler, this.mass * this.scaler);
    // fill(30,25,20);

    textAlign(CENTER, CENTER); // text(this.ws, this.pos.x, this.pos.y);

    pop();
  };

  this.edges = function () {
    if (this.pos.y > height) {
      this.vel.y *= -1;
      this.pos = createVector(width / 2, height / 2);
      this.vel = createVector(0, 0);
    }

    if (this.pos.x > width) {
      this.vel.x *= -1;
      this.pos = createVector(width / 2, height / 2);
      this.vel = createVector(0, 0);
    }

    if (this.pos.x < 0) {
      this.vel.x *= -1;
      this.pos = createVector(width / 2, height / 2);
      this.vel = createVector(0, 0);
    }

    if (this.pos.y < 0) {
      this.vel.x *= -1;
      this.pos = createVector(width / 2, height / 2);
      this.vel = createVector(0, 0);
    }
  };
}
/*!
 * aows
 * 
 * 
 * @author Lucas Lorenzo Pena <lucaslpena@gmail.com>
 * @version 0.1.0
 * Copyright 2019. CC-BY-NC-SA-4.0 licensed.
 */
function Particle(x, y, a) {
  this.atlas = a;
  this.offset = randomIntFromInterval(0, 100) / 100;
  this.pos = createVector(x, y);
  this.vel = createVector(random(-3, 3), random(-3, 3));
  this.acc = createVector(0, -8); // this.vel = createVector(0,0);
  // this.acc = createVector(0,0);

  this.mass = 10;
  this.G = 5;
  this.previousVel = createVector(0, 0);
  this.maxSpeed = 3;
  this.theta = 0.0;
  this.size = 20; // this.maxForce = 1;

  this.history = [];

  this.update = function () {
    this.offset += 0.1; // console.log(this.offset);

    this.edges();
    this.vel.add(this.acc);
    this.vel.limit(this.maxSpeed);
    this.pos.add(this.vel);
    this.acc.set(0, 0);

    if (frameCount % 10 == 1) {
      var v = createVector(this.pos.x, this.pos.y);
      this.history.push(v);

      if (this.history.length > 8) {
        this.history.splice(0, 1);
      } // console.log(this.pos);
      // console.log("current ^ last v");
      // console.log(this.history);

    }
  };

  this.display = function () {
    this.trailing();
    var theta = this.vel.heading() + radians(90);
    this.theta += this.vel.x * this.vel.mag() / 20;
    var r = 4;
    push();
    translate(this.pos.x, this.pos.y); // rotate(this.theta);

    textAlign(CENTER, CENTER);
    textSize(12);
    stroke(255);
    fill(225);
    text(this.atlas.kw, 0, 0);
    pop();
  };

  this.trailing = function () {
    for (var i = 0; i < this.history.length; i++) {
      var pos = this.history[i];
      push();
      translate(pos.x, pos.y);
      stroke('#f2dd1c');
      fill(225);
      point(0, 0);
      pop();
    }
  };

  this.edges = function () {
    if (this.pos.x < -this.size) this.pos.x = width + this.size;
    if (this.pos.y < -this.size) this.pos.y = height + this.size;
    if (this.pos.x > width + this.size) this.pos.x = -this.size;
    if (this.pos.y > height + this.size) this.pos.y = -this.size;
  };

  this.separate = function (vehicles) {
    var desiredseparation = this.size * 1.1;
    var sum = createVector();
    var count = 0;

    for (var i = 0; i < vehicles.length; i++) {
      var d = p5.Vector.dist(this.pos, vehicles[i].pos);

      if (d > 0 && d < desiredseparation) {
        var diff = p5.Vector.sub(this.pos, vehicles[i].pos);
        diff.normalize();
        diff.div(d);
        sum.add(diff);
        count++;
      }
    }

    if (count > 0) {
      sum.div(count);
      sum.normalize();
      sum.mult(this.maxSpeed * 2);
      var steer = p5.Vector.sub(sum, this.velocity);
      steer.limit(this.maxforce);
      this.applyForce(steer);
    }
  };

  this.applyForce = function (force) {
    var f = force.copy();
    f.div(this.mass);
    this.acc.add(f);
  }; //calculate attraction


  this.calculateAttraction = function (obj) {
    //calculate direction of force
    var force = p5.Vector.sub(this.pos, obj.pos); //distance between objects

    var distance = force.mag(); //limit vector to eliminate extreme values at very close or very far
    //distance = constrain(distance,20,25);
    //Not really important but is what it is to get direction

    force.normalize(); //calculate gravitational from magniitude

    var strength = this.G * this.mass * obj.mass / (distance * distance); //get force vector --> magnitude * direction

    force.mult(strength); //var force;

    return force;
  };

  this.applyGravity = function () {
    for (var i = 0; i < attractors.length; i++) {
      var a = attractors[i];

      if (a.ws === this.atlas.ws) {
        //get everyone applied to and attract to it
        // console.log('attracted to: ' + a.ws);
        var f = a.calculateAttraction(this); // console.log(f);

        this.applyForce(f);
      }
    }
  };
}
/*!
 * aows
 * 
 * 
 * @author Lucas Lorenzo Pena <lucaslpena@gmail.com>
 * @version 0.1.0
 * Copyright 2019. CC-BY-NC-SA-4.0 licensed.
 */
var text1 = new Blotter.Text("under construction üëÅ‚Äçüó®", {
  family: "Overpass Mono",
  size: 84,
  fill: "#171717"
});
var text2 = new Blotter.Text("ATLAS OF WEAK SIGNALS", {
  family: "'Nexa Bold', sans-serif",
  size: 54,
  fill: "#171717"
});
var material = new Blotter.ChannelSplitMaterial();
var material2 = new Blotter.FliesMaterial(); // var blotter1 = new Blotter(material, { texts : text1 });
// var scope1 = blotter1.forText(text1);
// scope1.appendTo(document.body);

var blotter2 = new Blotter(material2, {
  texts: text2
});
var scope2 = blotter2.forText(text2);
scope2.appendTo(document.body);
setTimeout(function () {
  var element = $('.b-canvas').detach();
  $('.modal').prepend(element);
}, 2000); //https://codepen.io/SimonEvans/pen/PQKgyQ
// https://github.com/bradley/blotter
// https://blotter.js.org/#/documentation
/*!
 * aows
 * 
 * 
 * @author Lucas Lorenzo Pena <lucaslpena@gmail.com>
 * @version 0.1.0
 * Copyright 2019. CC-BY-NC-SA-4.0 licensed.
 */
function randomIntFromInterval(min, max) {
  //min max may be included
  return Math.floor(Math.random() * (max - min + 1) + min);
}

var particles = [];
var limit = 10;
var weaksignals = [];
var keywords = [];
var attractors = [];
var jsonData = {};
var padding = 100;
var grid = 5;

function preload() {
  var jsonFile = "../data/fromspreadsheet.json";
  jsonData = loadJSON(jsonFile);
  console.log(jsonData);
}

var cnv;

var atlasObj = function (weaksignal, keyword) {
  this.kw = keyword;
  this.ws = weaksignal;
};

function centerCanvas() {
  cnv = createCanvas(windowWidth, windowHeight);
  var x = (windowWidth - width) / 2;
  var y = (windowHeight - height) / 2;
  cnv.position(x, y);
}

function windowResized() {
  centerCanvas();
}

function setup() {
  centerCanvas();
  setupWeakSignals();
  textFont("Overpass Mono");
  frameRate(60);
  setupObjects();
}

function draw() {
  background('#000');
  clear();

  for (var i = 0; i < particles.length; i++) {
    particles[i].applyGravity(); // particles[i].separate(particles);
    // particles[i].separate(attractors);

    particles[i].update();
    particles[i].display();
  }

  textSize(14);
  fill(0);
  attractors.forEach(function (a) {
    a.update();
    a.display();
  });
}

function setupObjects() {
  weaksignals.forEach(function (ws, i) {
    keywords[i].forEach(function (kw, j) {
      var atls = new atlasObj(ws, kw);
      console.log(atls);
      particles.push(new Particle(random(50, width - 50), random(50, height - 50), {
        ws: ws,
        kw: kw
      }));
    });
  });
}

function setupWeakSignals() {
  //clipping keyword list to random selected words until wordCount reached
  for (var i in jsonData) {
    var wordCount = 5;
    var items, index, item;

    if (jsonData[i]["keywords"].length > wordCount) {
      var newItems = [];

      for (var j = 0; j < wordCount; j++) {
        items = jsonData[i]["keywords"];
        index = Math.floor(Math.random() * items.length);
        item = items.splice(index, 1);
        newItems.push(item[0]); // console.log(item[0]);
      }

      console.log(newItems);
      jsonData[i]["keywords"] = newItems.slice();
    }
  } // console.log(jsonData);
  // console.log('setup');
  // console.log(jsonData);


  var j = 0,
      k = 0;

  for (var i in jsonData) {
    console.log(j, k);
    attractors.push(new Attractor(jsonData[i]["name"], j, k));
    weaksignals.push(jsonData[i]["name"]);
    keywords.push(jsonData[i]["keywords"]);
    console.log('hit');
    $(".s" + j + k).html("<h1>" + jsonData[i]["name"] + "</h1>");

    if (j == grid - 1) {
      k++;
      j = -1;
    }

    j++;
  } // console.log(weaksignals)
  // 3 * 3 grid

}

function reInit() {
  particles.splice(0, particles.length);
  weaksignals.splice(0, weaksignals.length);
  keywords.splice(0, keywords.length);
  attractors.splice(0, attractors.length);
  setupWeakSignals();
  setupObjects();
}

setInterval(function () {
  reInit();
}, 60000 * 5);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF0dHJhY3Rvci5qcyIsInBhcnRpY2xlLmpzIiwic2NyaXB0LmpzIiwic2tldGNoLmpzIl0sIm5hbWVzIjpbIkF0dHJhY3RvciIsIndlYWtzaWduYWwiLCJ4Q29yZCIsInlDb3JkIiwid3MiLCJsZW5ndGgiLCJ3aWR0aCIsInBhZGRpbmciLCJpbnRlcnZhbCIsImdyaWQiLCJjZW50ZXJYIiwiaGVpZ2h0IiwiY2VudGVyWSIsInBvcyIsImNyZWF0ZVZlY3RvciIsInZlbCIsImFjYyIsIm1hc3MiLCJHIiwic2NhbGVyIiwiY2FsY3VsYXRlQXR0cmFjdGlvbiIsInAiLCJmb3JjZSIsInA1IiwiVmVjdG9yIiwic3ViIiwicHVzaCIsIm9wYSIsIm5vaXNlIiwib2Zmc2V0Iiwic3Ryb2tlIiwiY29sb3IiLCJsaW5lIiwieCIsInkiLCJwb3AiLCJkaXN0YW5jZSIsIm1hZyIsImNvbnN0cmFpbiIsIm5vcm1hbGl6ZSIsInN0cmVuZ3RoIiwibXVsdCIsImFwcGx5Rm9yY2UiLCJmIiwiY29weSIsImRpdiIsImFkZCIsInVwZGF0ZSIsImVkZ2VzIiwic2V0IiwiZGlzcGxheSIsInRleHRBbGlnbiIsIkNFTlRFUiIsIlBhcnRpY2xlIiwiYSIsImF0bGFzIiwicmFuZG9tSW50RnJvbUludGVydmFsIiwicmFuZG9tIiwicHJldmlvdXNWZWwiLCJtYXhTcGVlZCIsInRoZXRhIiwic2l6ZSIsImhpc3RvcnkiLCJsaW1pdCIsImZyYW1lQ291bnQiLCJ2Iiwic3BsaWNlIiwidHJhaWxpbmciLCJoZWFkaW5nIiwicmFkaWFucyIsInIiLCJ0cmFuc2xhdGUiLCJ0ZXh0U2l6ZSIsImZpbGwiLCJ0ZXh0Iiwia3ciLCJpIiwicG9pbnQiLCJzZXBhcmF0ZSIsInZlaGljbGVzIiwiZGVzaXJlZHNlcGFyYXRpb24iLCJzdW0iLCJjb3VudCIsImQiLCJkaXN0IiwiZGlmZiIsInN0ZWVyIiwidmVsb2NpdHkiLCJtYXhmb3JjZSIsIm9iaiIsImFwcGx5R3Jhdml0eSIsImF0dHJhY3RvcnMiLCJ0ZXh0MSIsIkJsb3R0ZXIiLCJUZXh0IiwiZmFtaWx5IiwidGV4dDIiLCJtYXRlcmlhbCIsIkNoYW5uZWxTcGxpdE1hdGVyaWFsIiwibWF0ZXJpYWwyIiwiRmxpZXNNYXRlcmlhbCIsImJsb3R0ZXIyIiwidGV4dHMiLCJzY29wZTIiLCJmb3JUZXh0IiwiYXBwZW5kVG8iLCJkb2N1bWVudCIsImJvZHkiLCJzZXRUaW1lb3V0IiwiZWxlbWVudCIsIiQiLCJkZXRhY2giLCJwcmVwZW5kIiwibWluIiwibWF4IiwiTWF0aCIsImZsb29yIiwicGFydGljbGVzIiwid2Vha3NpZ25hbHMiLCJrZXl3b3JkcyIsImpzb25EYXRhIiwicHJlbG9hZCIsImpzb25GaWxlIiwibG9hZEpTT04iLCJjb25zb2xlIiwibG9nIiwiY252IiwiYXRsYXNPYmoiLCJrZXl3b3JkIiwiY2VudGVyQ2FudmFzIiwiY3JlYXRlQ2FudmFzIiwid2luZG93V2lkdGgiLCJ3aW5kb3dIZWlnaHQiLCJwb3NpdGlvbiIsIndpbmRvd1Jlc2l6ZWQiLCJzZXR1cCIsInNldHVwV2Vha1NpZ25hbHMiLCJ0ZXh0Rm9udCIsImZyYW1lUmF0ZSIsInNldHVwT2JqZWN0cyIsImRyYXciLCJiYWNrZ3JvdW5kIiwiY2xlYXIiLCJmb3JFYWNoIiwiaiIsImF0bHMiLCJ3b3JkQ291bnQiLCJpdGVtcyIsImluZGV4IiwiaXRlbSIsIm5ld0l0ZW1zIiwic2xpY2UiLCJrIiwiaHRtbCIsInJlSW5pdCIsInNldEludGVydmFsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBLFNBQVNBLFNBQVQsQ0FBbUJDLFVBQW5CLEVBQStCQyxLQUEvQixFQUFzQ0MsS0FBdEMsRUFBNkM7QUFDekMsT0FBS0MsRUFBTCxHQUFVSCxVQUFWO0FBQ0EsTUFBSUksTUFBTSxHQUFHQyxLQUFLLEdBQUcsSUFBRUMsT0FBdkI7QUFDQSxNQUFJQyxRQUFRLEdBQUlILE1BQU0sR0FBR0ksSUFBekI7QUFDQSxNQUFJQyxPQUFPLEdBQUdILE9BQU8sR0FBR0MsUUFBUSxJQUFJTixLQUFLLEdBQUMs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O0FBRUFtSSxFQUFBQSxnQkFBZ0I7QUFDaEJHLEVBQUFBLFlBQVk7QUFDZjs7QUFHRGdCLFdBQVcsQ0FBQyxZQUFVO0FBQ2xCRCxFQUFBQSxNQUFNO0FBQ1QsQ0FGVSxFQUVSLFFBQVEsQ0FGQSxDQUFYIiwiZmlsZSI6InNjcmlwdHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBBdHRyYWN0b3Iod2Vha3NpZ25hbCwgeENvcmQsIHlDb3JkKSB7XG4gICAgdGhpcy53cyA9IHdlYWtzaWduYWw7XG4gICAgdmFyIGxlbmd0aCA9IHdpZHRoIC0gMipwYWRkaW5nO1xuICAgIHZhciBpbnRlcnZhbCA9IChsZW5ndGggLyBncmlkKTtcbiAgICB2YXIgY2VudGVyWCA9IHBhZGRpbmcgKyBpbnRlcnZhbCAqICh4Q29yZCsxKTtcbiAgICBjZW50ZXJYID0gY2VudGVyWCAtIGludGVydmFsLzI7XG4gICAgbGVuZ3RoID0gaGVpZ2h0IC0gMipwYWRkaW5nO1xuICAgIGludGVydmFsID0gKGxlbmd0aCAvIGdyaWQpO1xuICAgIHZhciBjZW50ZXJZID0gcGFkZGluZyArIGludGVydmFsICogKHlDb3JkKzEpO1xuICAgIGNlbnRlclkgPSBjZW50ZXJZIC0gaW50ZXJ2YWwvMjtcblxuICAgIHRoaXMucG9zID0gY3JlYXRlVmVjdG9yKGNlbnRlclgsIGNlbnRlclkpO1xuICAgIHRoaXMudmVsID0gY3JlYXRlVmVjdG9yKDAsMCk7XG4gICAgdGhpcy5hY2MgPSBjcmVhdGVWZWN0b3IoMCwwKTtcblxuICAgIHRoaXMubWFzcyA9IDY7XG4gICAgdGhpcy5HID0gMjA7IC8vd2FzIDgwXG4gICAgdGhpcy5zY2FsZXIgPSA1O1xuXG4gICAgdGhpcy5jYWxjdWxhdGVBdHRyYWN0aW9uID0gZnVuY3Rpb24ocCl7XG4gICAgICAgIC8vY2FsY3VsYXRlIGRpcmVjdGlvbiBvZiBmb3JjZVxuICAgICAgICB2YXIgZm9yY2UgPSBwNS5WZWN0b3Iuc3ViKHRoaXMucG9zLCBwLnBvcyk7XG5cblxuXG4gICAgICAgIHB1c2goKTtcbiAgICAgICAgdmFyIG9wYSA9IG5vaXNlKHAub2Zmc2V0KSAqIDI1NTtcbiAgICAgICAgLy8gY29uc29sZS5sb2cob3BhKTtcblxuICAgICAgICBzdHJva2UoY29sb3IoNTAsNTAsNTAsb3BhKSk7XG4gICAgICAgIC8vIHN0cm9rZSgyNTUpO1xuICAgICAgICBsaW5lKHRoaXMucG9zLngsIHRoaXMucG9zLnksIHAucG9zLngsIHAucG9zLnkpO1xuICAgICAgICBwb3AoKTtcblxuICAgICAgICAvL2Rpc3RhbmNlIGJldHdlZW4gb2JqZWN0c1xuICAgICAgICB2YXIgZGlzdGFuY2UgPSBmb3JjZS5tYWcoKTtcblxuICAgICAgICAvL2xpbWl0IHZlY3RvciB0byBlbGltaW5hdGUgZXh0cmVtZSB2YWx1ZXMgYXQgdmVyeSBjbG9zZSBvciB2ZXJ5IGZhclxuICAgICAgICAvLyBkaXN0YW5jZSA9IGNvbnN0cmFpbihkaXN0YW5jZSwyMCwyNSk7XG4gICAgICAgIGRpc3RhbmNlID0gY29uc3RyYWluKGRpc3RhbmNlLDUwLDU1KTtcbiAgICAgICAgLy9Ob3QgcmVhbGx5IGltcG9ydGFudCBidXQgaXMgd2hhdCBpdCBpcyB0byBnZXQgZGlyZWN0aW9uXG4gICAgICAgIGZvcmNlLm5vcm1hbGl6ZSgpO1xuXG4gICAgICAgIC8vY2FsY3VsYXRlIGdyYXZpdGF0aW9uYWwgZnJvbSBtYWduaWl0dWRlXG4gICAgICAgIHZhciBzdHJlbmd0aCA9ICh0aGlzLkcgKiB0aGlzLm1hc3MgKiBwLm1hc3MpIC8gKGRpc3RhbmNlICogZGlzdGFuY2UpO1xuXG4gICAgICAgIC8vZ2V0IGZvcmNlIHZlY3RvciAtLT4gbWFnbml0dWRlICogZGlyZWN0aW9uXG4gICAgICAgIGZvcmNlLm11bHQoc3RyZW5ndGgpO1xuICAgICAgICAvL3ZhciBmb3JjZTtcbiAgICAgICAgcmV0dXJuIGZvcmNlO1xuICAgIH1cblxuICAgIHRoaXMuYXBwbHlGb3JjZSA9IGZ1bmN0aW9uKGZvcmNlKXtcbiAgICAgICAgLy8gQSA9IEYgL01cbiAgICAgICAgdmFyIGYgPSBmb3JjZS5jb3B5KCk7XG4gICAgICAgIGYuZGl2KHRoaXMubWFzcyk7XG4gICAgICAgIHRoaXMuYWNjLmFkZChmKTtcbiAgICB9XG5cbiAgICB0aGlzLnVwZGF0ZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuZWRnZXMoKTtcbiAgICAgICAgdGhpcy52ZWwuYWRkKHRoaXMuYWNjKTtcbiAgICAgICAgdGhpcy5wb3MuYWRkKHRoaXMudmVsKTtcbiAgICAgICAgdGhpcy5hY2Muc2V0KDAsMCk7XG4gICAgfVxuXG4gICAgdGhpcy5kaXNwbGF5ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcHVzaCgpO1xuICAgICAgICAvLyBmaWxsKDMwLDI1LDIwKTtcbiAgICAgICAgc3Ryb2tlKDMwLDI1LDMwKTtcbiAgICAgICAgLy8gZWxsaXBzZSh0aGlzLnBvcy54LCB0aGlzLnBvcy55LCB0aGlzLm1hc3MgKiB0aGlzLnNjYWxlciwgdGhpcy5tYXNzICogdGhpcy5zY2FsZXIpO1xuICAgICAgICAvLyBmaWxsKDMwLDI1LDIwKTtcbiAgICAgICAgdGV4dEFsaWduKENFTlRFUiwgQ0VOVEVSKTtcbiAgICAgICAgLy8gdGV4dCh0aGlzLndzLCB0aGlzLnBvcy54LCB0aGlzLnBvcy55KTtcbiAgICAgICAgcG9wKCk7XG4gICAgfVxuXG4gICAgdGhpcy5lZGdlcyA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmICh0aGlzLnBvcy55ID4gaGVpZ2h0KSB7XG4gICAgICAgICAgICB0aGlzLnZlbC55ICo9IC0xO1xuICAgICAgICAgICAgdGhpcy5wb3MgPSBjcmVhdGVWZWN0b3Iod2lkdGgvMiwgaGVpZ2h0LzIpO1xuICAgICAgICAgICAgdGhpcy52ZWwgPSBjcmVhdGVWZWN0b3IoMCwwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wb3MueCA+IHdpZHRoKSB7XG4gICAgICAgICAgICB0aGlzLnZlbC54ICo9IC0xO1xuICAgICAgICAgICAgdGhpcy5wb3MgPSBjcmVhdGVWZWN0b3Iod2lkdGgvMiwgaGVpZ2h0LzIpO1xuICAgICAgICAgICAgdGhpcy52ZWwgPSBjcmVhdGVWZWN0b3IoMCwwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wb3MueCA8IDApIHtcbiAgICAgICAgICAgIHRoaXMudmVsLnggKj0gLTE7XG4gICAgICAgICAgICB0aGlzLnBvcyA9IGNyZWF0ZVZlY3Rvcih3aWR0aC8yLCBoZWlnaHQvMik7XG4gICAgICAgICAgICB0aGlzLnZlbCA9IGNyZWF0ZVZlY3RvcigwLDApO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBvcy55IDwgMCkge1xuICAgICAgICAgICAgdGhpcy52ZWwueCAqPSAtMTtcbiAgICAgICAgICAgIHRoaXMucG9zID0gY3JlYXRlVmVjdG9yKHdpZHRoLzIsIGhlaWdodC8yKTtcbiAgICAgICAgICAgIHRoaXMudmVsID0gY3JlYXRlVmVjdG9yKDAsMCk7XG4gICAgICAgIH1cbiAgICB9XG5cbn0iLCJmdW5jdGlvbiBQYXJ0aWNsZSh4LHksYSl7XG4gICAgdGhpcy5hdGxhcyA9IGE7XG5cbiAgICB0aGlzLm9mZnNldCA9IHJhbmRvbUludEZyb21JbnRlcnZhbCgwLDEwMCkvMTAwO1xuXG5cblxuICAgIHRoaXMucG9zID0gY3JlYXRlVmVjdG9yKHgsIHkpO1xuICAgIHRoaXMudmVsID0gY3JlYXRlVmVjdG9yKHJhbmRvbSgtMywzKSxyYW5kb20oLTMsMykpO1xuICAgIHRoaXMuYWNjID0gY3JlYXRlVmVjdG9yKDAsLTgpO1xuXG4gICAgLy8gdGhpcy52ZWwgPSBjcmVhdGVWZWN0b3IoMCwwKTtcbiAgICAvLyB0aGlzLmFjYyA9IGNyZWF0ZVZlY3RvcigwLDApO1xuXG4gICAgdGhpcy5tYXNzID0gMTA7XG4gICAgdGhpcy5HID0gNTtcbiAgICB0aGlzLnByZXZpb3VzVmVsID0gY3JlYXRlVmVjdG9yKDAsMCk7XG4gICAgdGhpcy5tYXhTcGVlZCA9IDM7XG5cbiAgICB0aGlzLnRoZXRhID0gMC4wO1xuICAgIHRoaXMuc2l6ZSA9IDIwO1xuICAgIC8vIHRoaXMubWF4Rm9yY2UgPSAxO1xuXG4gICAgdGhpcy5oaXN0b3J5ID0gW107XG5cblxuICAgIHRoaXMudXBkYXRlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5vZmZzZXQgKz0gMC4xO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLm9mZnNldCk7XG4gICAgICAgIHRoaXMuZWRnZXMoKTtcbiAgICAgICAgdGhpcy52ZWwuYWRkKHRoaXMuYWNjKTtcbiAgICAgICAgdGhpcy52ZWwubGltaXQodGhpcy5tYXhTcGVlZCk7XG4gICAgICAgIHRoaXMucG9zLmFkZCh0aGlzLnZlbCk7XG4gICAgICAgIHRoaXMuYWNjLnNldCgwLDApO1xuXG5cbiAgICAgICAgaWYgKGZyYW1lQ291bnQgJSAxMCA9PSAxKXtcbiAgICAgICAgICAgIHZhciB2ID0gY3JlYXRlVmVjdG9yKHRoaXMucG9zLngsIHRoaXMucG9zLnkpO1xuICAgICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2godik7XG4gICAgICAgICAgICBpZiAodGhpcy5oaXN0b3J5Lmxlbmd0aCA+IDgpe1xuICAgICAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5zcGxpY2UoMCwxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMucG9zKTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiY3VycmVudCBeIGxhc3QgdlwiKTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuaGlzdG9yeSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmRpc3BsYXkgPSBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLnRyYWlsaW5nKCk7XG4gICAgICAgIHZhciB0aGV0YSA9IHRoaXMudmVsLmhlYWRpbmcoKSArIHJhZGlhbnMoOTApO1xuICAgICAgICB0aGlzLnRoZXRhICs9ICh0aGlzLnZlbC54ICogdGhpcy52ZWwubWFnKCkpIC8gMjA7XG4gICAgICAgIHZhciByID0gNDtcbiAgICAgICAgcHVzaCgpO1xuICAgICAgICB0cmFuc2xhdGUodGhpcy5wb3MueCwgdGhpcy5wb3MueSk7XG4gICAgICAgIC8vIHJvdGF0ZSh0aGlzLnRoZXRhKTtcbiAgICAgICAgdGV4dEFsaWduKENFTlRFUiwgQ0VOVEVSKTtcbiAgICAgICAgdGV4dFNpemUoMTIpO1xuICAgICAgICBzdHJva2UoMjU1KTtcbiAgICAgICAgZmlsbCgyMjUpO1xuICAgICAgICB0ZXh0KHRoaXMuYXRsYXMua3csIDAsMCk7XG4gICAgICAgIHBvcCgpO1xuICAgIH1cblxuICAgIHRoaXMudHJhaWxpbmcgPSBmdW5jdGlvbigpe1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaGlzdG9yeS5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICB2YXIgcG9zID0gdGhpcy5oaXN0b3J5W2ldO1xuICAgICAgICAgICAgcHVzaCgpO1xuICAgICAgICAgICAgdHJhbnNsYXRlKHBvcy54LCBwb3MueSk7XG4gICAgICAgICAgICBzdHJva2UoJyNmMmRkMWMnKTtcbiAgICAgICAgICAgIGZpbGwoMjI1KTtcblxuICAgICAgICAgICAgcG9pbnQoMCwwKTtcbiAgICAgICAgICAgIHBvcCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5lZGdlcyA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmICh0aGlzLnBvcy54IDwgLXRoaXMuc2l6ZSkgdGhpcy5wb3MueCA9IHdpZHRoK3RoaXMuc2l6ZTtcbiAgICAgICAgaWYgKHRoaXMucG9zLnkgPCAtdGhpcy5zaXplKSB0aGlzLnBvcy55ID0gaGVpZ2h0K3RoaXMuc2l6ZTtcbiAgICAgICAgaWYgKHRoaXMucG9zLnggPiB3aWR0aCt0aGlzLnNpemUpIHRoaXMucG9zLnggPSAtdGhpcy5zaXplO1xuICAgICAgICBpZiAodGhpcy5wb3MueSA+IGhlaWdodCt0aGlzLnNpemUpIHRoaXMucG9zLnkgPSAtdGhpcy5zaXplO1xuICAgIH1cblxuICAgIHRoaXMuc2VwYXJhdGUgPSBmdW5jdGlvbih2ZWhpY2xlcykge1xuICAgICAgICB2YXIgZGVzaXJlZHNlcGFyYXRpb24gPSB0aGlzLnNpemUqMS4xO1xuICAgICAgICB2YXIgc3VtID0gY3JlYXRlVmVjdG9yKCk7XG4gICAgICAgIHZhciBjb3VudCA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmVoaWNsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBkID0gcDUuVmVjdG9yLmRpc3QodGhpcy5wb3MsIHZlaGljbGVzW2ldLnBvcyk7XG4gICAgICAgICAgICBpZiAoKGQgPiAwKSAmJiAoZCA8IGRlc2lyZWRzZXBhcmF0aW9uKSkge1xuICAgICAgICAgICAgICAgIHZhciBkaWZmID0gcDUuVmVjdG9yLnN1Yih0aGlzLnBvcywgdmVoaWNsZXNbaV0ucG9zKTtcbiAgICAgICAgICAgICAgICBkaWZmLm5vcm1hbGl6ZSgpO1xuICAgICAgICAgICAgICAgIGRpZmYuZGl2KGQpO1xuICAgICAgICAgICAgICAgIHN1bS5hZGQoZGlmZik7XG4gICAgICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY291bnQgPiAwKSB7XG4gICAgICAgICAgICBzdW0uZGl2KGNvdW50KTtcbiAgICAgICAgICAgIHN1bS5ub3JtYWxpemUoKTtcbiAgICAgICAgICAgIHN1bS5tdWx0KHRoaXMubWF4U3BlZWQgKiAyKTtcbiAgICAgICAgICAgIHZhciBzdGVlciA9IHA1LlZlY3Rvci5zdWIoc3VtLCB0aGlzLnZlbG9jaXR5KTtcbiAgICAgICAgICAgIHN0ZWVyLmxpbWl0KHRoaXMubWF4Zm9yY2UpO1xuICAgICAgICAgICAgdGhpcy5hcHBseUZvcmNlKHN0ZWVyKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuYXBwbHlGb3JjZSA9IGZ1bmN0aW9uKGZvcmNlKSB7XG4gICAgICAgIHZhciBmID0gZm9yY2UuY29weSgpO1xuICAgICAgICBmLmRpdih0aGlzLm1hc3MpO1xuICAgICAgICB0aGlzLmFjYy5hZGQoZik7XG4gICAgfVxuXG4gICAgLy9jYWxjdWxhdGUgYXR0cmFjdGlvblxuICAgIHRoaXMuY2FsY3VsYXRlQXR0cmFjdGlvbiA9IGZ1bmN0aW9uKG9iail7XG4gICAgICAgIC8vY2FsY3VsYXRlIGRpcmVjdGlvbiBvZiBmb3JjZVxuICAgICAgICB2YXIgZm9yY2UgPSBwNS5WZWN0b3Iuc3ViKHRoaXMucG9zLCBvYmoucG9zKTtcblxuICAgICAgICAvL2Rpc3RhbmNlIGJldHdlZW4gb2JqZWN0c1xuICAgICAgICB2YXIgZGlzdGFuY2UgPSBmb3JjZS5tYWcoKTtcbiAgICAgICAgLy9saW1pdCB2ZWN0b3IgdG8gZWxpbWluYXRlIGV4dHJlbWUgdmFsdWVzIGF0IHZlcnkgY2xvc2Ugb3IgdmVyeSBmYXJcbiAgICAgICAgLy9kaXN0YW5jZSA9IGNvbnN0cmFpbihkaXN0YW5jZSwyMCwyNSk7XG4gICAgICAgIC8vTm90IHJlYWxseSBpbXBvcnRhbnQgYnV0IGlzIHdoYXQgaXQgaXMgdG8gZ2V0IGRpcmVjdGlvblxuICAgICAgICBmb3JjZS5ub3JtYWxpemUoKTtcblxuICAgICAgICAvL2NhbGN1bGF0ZSBncmF2aXRhdGlvbmFsIGZyb20gbWFnbmlpdHVkZVxuICAgICAgICB2YXIgc3RyZW5ndGggPSAodGhpcy5HICogdGhpcy5tYXNzICogb2JqLm1hc3MpIC8gKGRpc3RhbmNlICogZGlzdGFuY2UpO1xuXG4gICAgICAgIC8vZ2V0IGZvcmNlIHZlY3RvciAtLT4gbWFnbml0dWRlICogZGlyZWN0aW9uXG4gICAgICAgIGZvcmNlLm11bHQoc3RyZW5ndGgpO1xuICAgICAgICAvL3ZhciBmb3JjZTtcbiAgICAgICAgcmV0dXJuIGZvcmNlO1xuICAgIH1cblxuICAgIHRoaXMuYXBwbHlHcmF2aXR5ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhdHRyYWN0b3JzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgIHZhciBhID0gYXR0cmFjdG9yc1tpXTtcbiAgICAgICAgICAgIGlmIChhLndzID09PSB0aGlzLmF0bGFzLndzKXsgLy9nZXQgZXZlcnlvbmUgYXBwbGllZCB0byBhbmQgYXR0cmFjdCB0byBpdFxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdhdHRyYWN0ZWQgdG86ICcgKyBhLndzKTtcbiAgICAgICAgICAgICAgICB2YXIgZiA9IGEuY2FsY3VsYXRlQXR0cmFjdGlvbih0aGlzKTtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhmKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGx5Rm9yY2UoZik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbn1cbiIsInZhciB0ZXh0MSA9IG5ldyBCbG90dGVyLlRleHQoXCJ1bmRlciBjb25zdHJ1Y3Rpb24g8J+RgeKAjfCfl6hcIiwge1xuICAgIGZhbWlseSA6IFwiT3ZlcnBhc3MgTW9ub1wiLFxuICAgIHNpemUgOiA4NCxcbiAgICBmaWxsIDogXCIjMTcxNzE3XCJcbn0pO1xuXG52YXIgdGV4dDIgPSBuZXcgQmxvdHRlci5UZXh0KFwiQVRMQVMgT0YgV0VBSyBTSUdOQUxTXCIsIHtcbiAgICBmYW1pbHkgOiBcIidOZXhhIEJvbGQnLCBzYW5zLXNlcmlmXCIsXG4gICAgc2l6ZSA6IDU0LFxuICAgIGZpbGwgOiBcIiMxNzE3MTdcIlxufSk7XG5cbnZhciBtYXRlcmlhbCA9IG5ldyBCbG90dGVyLkNoYW5uZWxTcGxpdE1hdGVyaWFsKCk7XG52YXIgbWF0ZXJpYWwyID0gbmV3IEJsb3R0ZXIuRmxpZXNNYXRlcmlhbCgpO1xuXG4vLyB2YXIgYmxvdHRlcjEgPSBuZXcgQmxvdHRlcihtYXRlcmlhbCwgeyB0ZXh0cyA6IHRleHQxIH0pO1xuLy8gdmFyIHNjb3BlMSA9IGJsb3R0ZXIxLmZvclRleHQodGV4dDEpO1xuLy8gc2NvcGUxLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpO1xuXG52YXIgYmxvdHRlcjIgPSBuZXcgQmxvdHRlcihtYXRlcmlhbDIsIHsgdGV4dHMgOiB0ZXh0MiB9KTtcbnZhciBzY29wZTIgPSBibG90dGVyMi5mb3JUZXh0KHRleHQyKTtcbnNjb3BlMi5hcHBlbmRUbyhkb2N1bWVudC5ib2R5KTtcblxuc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgIHZhciBlbGVtZW50ID0gJCgnLmItY2FudmFzJykuZGV0YWNoKCk7XG4gICAgJCgnLm1vZGFsJykucHJlcGVuZChlbGVtZW50KTtcbn0sMjAwMCk7XG5cbi8vaHR0cHM6Ly9jb2RlcGVuLmlvL1NpbW9uRXZhbnMvcGVuL1BRS2d5UVxuLy8gaHR0cHM6Ly9naXRodWIuY29tL2JyYWRsZXkvYmxvdHRlclxuLy8gaHR0cHM6Ly9ibG90dGVyLmpzLm9yZy8jL2RvY3VtZW50YXRpb24iLCJmdW5jdGlvbiByYW5kb21JbnRGcm9tSW50ZXJ2YWwobWluLG1heCl7IC8vbWluIG1heCBtYXkgYmUgaW5jbHVkZWRcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKihtYXgtbWluKzEpK21pbik7XG59XG5cblxudmFyIHBhcnRpY2xlcyA9IFtdO1xudmFyIGxpbWl0ID0gMTA7XG52YXIgd2Vha3NpZ25hbHMgPSBbXTtcbnZhciBrZXl3b3JkcyA9IFtdO1xudmFyIGF0dHJhY3RvcnMgPSBbXTtcbnZhciBqc29uRGF0YSA9IHt9O1xudmFyIHBhZGRpbmcgPSAxMDA7XG52YXIgZ3JpZCA9IDU7XG5cblxuZnVuY3Rpb24gcHJlbG9hZCgpIHtcbiAgICB2YXIganNvbkZpbGUgPSBcIi4uL2RhdGEvZnJvbXNwcmVhZHNoZWV0Lmpzb25cIjtcbiAgICBqc29uRGF0YSA9IGxvYWRKU09OKGpzb25GaWxlKTtcbiAgICBjb25zb2xlLmxvZyhqc29uRGF0YSk7XG59XG5cbnZhciBjbnY7XG5cblxudmFyIGF0bGFzT2JqID0gZnVuY3Rpb24od2Vha3NpZ25hbCwga2V5d29yZCl7XG4gICAgdGhpcy5rdyA9IGtleXdvcmQ7XG4gICAgdGhpcy53cyA9IHdlYWtzaWduYWw7XG59O1xuXG5mdW5jdGlvbiBjZW50ZXJDYW52YXMoKSB7XG4gICAgY252ID0gY3JlYXRlQ2FudmFzKHdpbmRvd1dpZHRoLCB3aW5kb3dIZWlnaHQpO1xuICAgIHZhciB4ID0gKHdpbmRvd1dpZHRoIC0gd2lkdGgpIC8gMjtcbiAgICB2YXIgeSA9ICh3aW5kb3dIZWlnaHQgLSBoZWlnaHQpIC8gMjtcbiAgICBjbnYucG9zaXRpb24oeCwgeSk7XG59XG5cbmZ1bmN0aW9uIHdpbmRvd1Jlc2l6ZWQoKSB7XG4gICAgY2VudGVyQ2FudmFzKCk7XG59XG5cbmZ1bmN0aW9uIHNldHVwKCkge1xuICAgIGNlbnRlckNhbnZhcygpO1xuICAgIHNldHVwV2Vha1NpZ25hbHMoKTtcbiAgICB0ZXh0Rm9udChcIk92ZXJwYXNzIE1vbm9cIik7XG4gICAgZnJhbWVSYXRlKDYwKTtcbiAgICBzZXR1cE9iamVjdHMoKTtcbn1cblxuZnVuY3Rpb24gZHJhdygpIHtcbiAgICBiYWNrZ3JvdW5kKCcjMDAwJyk7XG4gICAgY2xlYXIoKTtcblxuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJ0aWNsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgcGFydGljbGVzW2ldLmFwcGx5R3Jhdml0eSgpO1xuICAgICAgICAvLyBwYXJ0aWNsZXNbaV0uc2VwYXJhdGUocGFydGljbGVzKTtcbiAgICAgICAgLy8gcGFydGljbGVzW2ldLnNlcGFyYXRlKGF0dHJhY3RvcnMpO1xuICAgICAgICBwYXJ0aWNsZXNbaV0udXBkYXRlKCk7XG4gICAgICAgIHBhcnRpY2xlc1tpXS5kaXNwbGF5KCk7XG4gICAgfVxuXG4gICAgdGV4dFNpemUoMTQpO1xuICAgIGZpbGwoMCk7XG4gICAgYXR0cmFjdG9ycy5mb3JFYWNoKGZ1bmN0aW9uKGEpe1xuICAgICAgICBhLnVwZGF0ZSgpO1xuICAgICAgICBhLmRpc3BsYXkoKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gc2V0dXBPYmplY3RzKCl7XG4gICAgd2Vha3NpZ25hbHMuZm9yRWFjaChmdW5jdGlvbih3cywgaSl7XG4gICAgICAgIGtleXdvcmRzW2ldLmZvckVhY2goZnVuY3Rpb24oa3csIGope1xuICAgICAgICAgICAgdmFyIGF0bHMgPSBuZXcgYXRsYXNPYmood3MsIGt3KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGF0bHMpO1xuICAgICAgICAgICAgcGFydGljbGVzLnB1c2gobmV3IFBhcnRpY2xlKHJhbmRvbSg1MCwgd2lkdGggLSA1MCksIHJhbmRvbSg1MCwgaGVpZ2h0IC0gNTApLCB7d3M6d3MsIGt3Omt3fSkpO1xuICAgICAgICB9KTtcbiAgICB9KVxufVxuXG5mdW5jdGlvbiBzZXR1cFdlYWtTaWduYWxzKCl7XG5cbiAgICAvL2NsaXBwaW5nIGtleXdvcmQgbGlzdCB0byByYW5kb20gc2VsZWN0ZWQgd29yZHMgdW50aWwgd29yZENvdW50IHJlYWNoZWRcbiAgICBmb3IgKHZhciBpIGluIGpzb25EYXRhKXtcbiAgICAgICAgdmFyIHdvcmRDb3VudCA9IDU7XG4gICAgICAgIHZhciBpdGVtcywgaW5kZXgsIGl0ZW07XG4gICAgICAgIGlmIChqc29uRGF0YVtpXVtcImtleXdvcmRzXCJdLmxlbmd0aCA+IHdvcmRDb3VudCkge1xuICAgICAgICAgICAgdmFyIG5ld0l0ZW1zID0gW107XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHdvcmRDb3VudDsgaisrKSB7XG4gICAgICAgICAgICAgICAgaXRlbXMgPSBqc29uRGF0YVtpXVtcImtleXdvcmRzXCJdO1xuICAgICAgICAgICAgICAgIGluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogaXRlbXMubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBpdGVtID0gaXRlbXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICBuZXdJdGVtcy5wdXNoKGl0ZW1bMF0pO1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGl0ZW1bMF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc29sZS5sb2cobmV3SXRlbXMpO1xuICAgICAgICAgICAganNvbkRhdGFbaV1bXCJrZXl3b3Jkc1wiXSA9IG5ld0l0ZW1zLnNsaWNlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gY29uc29sZS5sb2coanNvbkRhdGEpO1xuXG5cbiAgICAvLyBjb25zb2xlLmxvZygnc2V0dXAnKTtcbiAgICAvLyBjb25zb2xlLmxvZyhqc29uRGF0YSk7XG5cbiAgICB2YXIgaiA9IDAsIGsgPSAwO1xuICAgIGZvciAodmFyIGkgaW4ganNvbkRhdGEpe1xuICAgICAgICBjb25zb2xlLmxvZyhqLGspO1xuICAgICAgICBhdHRyYWN0b3JzLnB1c2gobmV3IEF0dHJhY3Rvcihqc29uRGF0YVtpXVtcIm5hbWVcIl0sIGosIGspKTtcbiAgICAgICAgd2Vha3NpZ25hbHMucHVzaChqc29uRGF0YVtpXVtcIm5hbWVcIl0pO1xuICAgICAgICBrZXl3b3Jkcy5wdXNoKGpzb25EYXRhW2ldW1wia2V5d29yZHNcIl0pO1xuICAgICAgICBjb25zb2xlLmxvZygnaGl0Jyk7XG4gICAgICAgICQoKFwiLnNcIiArIGopK2spLmh0bWwoXCI8aDE+XCIranNvbkRhdGFbaV1bXCJuYW1lXCJdICtcIjwvaDE+XCIpO1xuICAgICAgICBpZiAoaiA9PSAoZ3JpZC0xKSl7XG4gICAgICAgICAgICBrKys7XG4gICAgICAgICAgICBqID0gLTE7XG4gICAgICAgIH1cbiAgICAgICAgaisrO1xuICAgIH1cblxuICAgIC8vIGNvbnNvbGUubG9nKHdlYWtzaWduYWxzKVxuICAgIC8vIDMgKiAzIGdyaWRcbn1cblxuZnVuY3Rpb24gcmVJbml0KCl7XG4gICAgcGFydGljbGVzLnNwbGljZSgwLHBhcnRpY2xlcy5sZW5ndGgpO1xuICAgIHdlYWtzaWduYWxzLnNwbGljZSgwLHdlYWtzaWduYWxzLmxlbmd0aCk7XG4gICAga2V5d29yZHMuc3BsaWNlKDAsa2V5d29yZHMubGVuZ3RoKTtcbiAgICBhdHRyYWN0b3JzLnNwbGljZSgwLGF0dHJhY3RvcnMubGVuZ3RoKTtcblxuICAgIHNldHVwV2Vha1NpZ25hbHMoKTtcbiAgICBzZXR1cE9iamVjdHMoKTtcbn1cblxuXG5zZXRJbnRlcnZhbChmdW5jdGlvbigpe1xuICAgIHJlSW5pdCgpO1xufSwgNjAwMDAgKiA1KTsiXX0=
